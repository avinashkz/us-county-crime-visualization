---
title: "Wrangle"
author: "Avinash"
date: '2018-02-20'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyr)
library(dplyr)
library(forcats)
library(purrr)
library(feather)

```

```{r}

#https://ucr.fbi.gov/ucr-publications

cleaner <- function(year,x,y){

#df <- readxl::read_xls("../data/2016.xls")
df <- readxl::read_xls(paste("../data/",year ,".xls",sep = ""))

#df <- df[5:(nrow(df) - 9),]
df <- df[x:(nrow(df) - y),]

names(df) <- c("State", "County", "ViolentCrime", "Homicide", "RapeRevised", "RapeLegacy", "Robbery", "AggravatedAssault", "PropertyCrime", "Burglary", "Larceny", "MotorVehicleTheft", "Arson")

df_1 <- df %>% separate(State, into = c("State", "Type"))


for (i in 1:nrow(df_1)){
  
if(is.na(df_1[i,1])){
  df_1[i,1] <-  df_1[i-1,1]
}
if(is.na(df_1[i,2])){
  df_1[i,2] <-  df_1[i-1,2]
}
}

df_1$State <- stringi::stri_trans_totitle(df_1$State)

df_1 <- df_1 %>% rowwise() %>% mutate(Rape = sum(as.numeric(RapeRevised),as.numeric(RapeLegacy), na.rm = TRUE))

df_2 <- df_1 %>% select(c(1:5, 8:15))

return(df_2)
}

data <- cleaner(2016, 5, 9)

#write.csv(data, "../results/2016.csv")
feather::write_feather(data, "../results/2016.feather")

```


```{r}
data %>% group_by(State) %>% summarise()
data %>% group_by(County) %>% summarise()

```

